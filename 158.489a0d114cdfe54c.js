"use strict";(self.webpackChunkweb_mzima_client=self.webpackChunkweb_mzima_client||[]).push([[158],{65158:(Ot,O,a)=>{a.r(O),a.d(O,{DataImportModule:()=>v});var d=a(52954),Z=a(93557),L=a(95432),F=a(37661),M=a(63953),y=a(48281),q=a(56370),c=a(25303),u=a(81547),S=a(89857),m=a(40930),_=a(85566),p=a.n(_),k=a(3012),A=a(49119),w=a(31020),j=a(65892),T=a(74794),Y=a(98703),E=a(51167),D=a(59132),t=a(39609),N=a(53625),g=a(952),z=a(94626),J=a(93149);function V(o,n){1&o&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"app.import")))}function R(o,n){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function B(o,n){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"strong"),t._uU(4),t.qZA(),t._uU(5),t.ALo(6,"translate"),t.qZA()),2&o){const e=t.oxw(4);t.xp6(1),t.hij(" ",t.lcZ(2,3,"data_import.has_tasks_required_start")," "),t.xp6(3),t.Oqu(e.selectedForm.name),t.xp6(1),t.hij(" ",t.lcZ(6,5,"data_import.has_tasks_required_end")," ")}}function K(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",28)(1,"mat-radio-group",29),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw(3);return t.KtG(s.selectedStatus=r)}),t.TgZ(2,"div",16)(3,"mat-radio-button",9),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.YNc(6,B,7,7,"p",1),t.TgZ(7,"div",16)(8,"mat-radio-button",9),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"div",16)(12,"mat-radio-button",9),t._uU(13),t.ALo(14,"translate"),t.qZA()()()()}if(2&o){const e=t.oxw(3);t.xp6(1),t.Q6J("ngModel",e.selectedStatus)("data-qa","radio-status"),t.xp6(2),t.Q6J("value",e.PostStatus.Published),t.xp6(1),t.hij(" ",t.lcZ(5,9,"post.published")," "),t.xp6(2),t.Q6J("ngIf",e.hasRequiredTask),t.xp6(2),t.Q6J("value",e.PostStatus.Draft),t.xp6(1),t.hij(" ",t.lcZ(10,11,"post.draft")," "),t.xp6(3),t.Q6J("value",e.PostStatus.Archived),t.xp6(1),t.hij(" ",t.lcZ(14,13,"post.archived")," ")}}function H(o,n){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",n.index),t.xp6(1),t.hij(" ",e," ")}}function $(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",30)(1,"div",28)(2,"div",5)(3,"mat-form-field",6)(4,"mat-select",31),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw(3);return t.KtG(s.selectedStatus=r)}),t.ALo(5,"translate"),t.YNc(6,H,2,2,"mat-option",8),t.qZA(),t.TgZ(7,"mat-hint"),t._uU(8),t.ALo(9,"translate"),t.qZA()()()()()}if(2&o){const e=t.oxw(3);t.xp6(4),t.s9C("placeholder",t.lcZ(5,4,"app.choose")),t.Q6J("ngModel",e.selectedStatus),t.xp6(2),t.Q6J("ngForOf",e.uploadedCSV.columns),t.xp6(2),t.Oqu(t.lcZ(9,6,"data_import.status_explanation"))}}function G(o,n){1&o&&(t.TgZ(0,"th",39),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"data_import.survey_field")))}function X(o,n){1&o&&(t.ynx(0),t._uU(1,"*"),t.BQk())}function W(o,n){if(1&o&&(t.TgZ(0,"td",40),t._uU(1),t.YNc(2,X,2,0,"ng-container",1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.label,"\xa0 "),t.xp6(1),t.Q6J("ngIf",e.required)}}function tt(o,n){1&o&&(t.TgZ(0,"th",39),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"data_import.csv_column")))}function et(o,n){if(1&o&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",n.index),t.xp6(1),t.hij(" ",e," ")}}function nt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"td",40)(1,"mat-form-field",6)(2,"mat-select",41),t.NdJ("ngModelChange",function(r){const l=t.CHM(e).$implicit,C=t.oxw(4);return t.KtG(C.maps_to[C.getFieldKey(l)]=r)}),t.ALo(3,"translate"),t.TgZ(4,"mat-option",42),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.YNc(7,et,2,2,"mat-option",8),t.qZA()()()}if(2&o){const e=n.$implicit,i=t.oxw(4);t.xp6(2),t.Q6J("data-qa","select-columns")("ngModel",i.maps_to[i.getFieldKey(e)])("placeholder",t.lcZ(3,6,"data_import.leave_empty")),t.xp6(3),t.AsE(" ",t.lcZ(6,8,"data_import.leave_empty")," ",e.key," "),t.xp6(2),t.Q6J("ngForOf",i.uploadedCSV.columns)}}function ot(o,n){1&o&&t._UZ(0,"tr",43)}function it(o,n){1&o&&t._UZ(0,"tr",44)}function at(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",21)(2,"mat-label",22),t._uU(3),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA()(),t.TgZ(6,"table",32),t.ynx(7,33),t.YNc(8,G,3,3,"th",34),t.YNc(9,W,3,2,"td",35),t.BQk(),t.ynx(10,36),t.YNc(11,tt,3,3,"th",34),t.YNc(12,nt,8,10,"td",35),t.BQk(),t.YNc(13,ot,1,0,"tr",37),t.YNc(14,it,1,0,"tr",38),t.qZA(),t.BQk()),2&o){const e=n.$implicit,i=t.oxw(3);t.xp6(3),t.hij(" ",e.label," "),t.xp6(2),t.Oqu(e.description),t.xp6(1),t.Q6J("dataSource",e.fields),t.xp6(7),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns)}}function rt(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"notify.data_import.csv_import_error")," "))}function st(o,n){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",5)(2,"mat-label"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"mat-radio-group",15),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw(2);return t.KtG(s.statusOption=r)}),t.ALo(6,"translate"),t.TgZ(7,"div",16)(8,"mat-radio-button",17),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.YNc(11,K,15,15,"div",18),t.qZA(),t.TgZ(12,"div",16)(13,"mat-radio-button",19),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.YNc(16,$,10,8,"div",20),t.qZA()()(),t.ynx(17),t.TgZ(18,"div",21)(19,"mat-label",22),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.ALo(24,"translate"),t.qZA()(),t.BQk(),t.YNc(25,at,15,5,"ng-container",23),t.YNc(26,rt,3,3,"mat-error",1),t._UZ(27,"div",24),t.TgZ(28,"div",25)(29,"mzima-client-button",26),t.NdJ("buttonClick",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.cancelImport())}),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"mzima-client-button",27),t.NdJ("buttonClick",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.finish())}),t._uU(33),t.ALo(34,"translate"),t.qZA()(),t.BQk()}if(2&o){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,16,"data_import.choose_status_to_imported_posts")),t.xp6(2),t.Q6J("data-qa","radio-option")("ngModel",e.statusOption),t.uIk("aria-label",t.lcZ(6,18,"data_import.imported_posts_status")),t.xp6(4),t.hij(" ",t.lcZ(10,20,"data_import.marked_as")," "),t.xp6(2),t.Q6J("ngIf","mark_as"===e.statusOption),t.xp6(3),t.hij(" ",t.lcZ(15,22,"data_import.defined_column")," "),t.xp6(2),t.Q6J("ngIf","defined_column"===e.statusOption),t.xp6(4),t.Oqu(t.lcZ(21,24,"data_import.choose_which_column")),t.xp6(3),t.Oqu(t.lcZ(24,26,"data_import.each_survey_field")),t.xp6(2),t.Q6J("ngForOf",e.selectedForm.tasks),t.xp6(1),t.Q6J("ngIf",e.importErrors),t.xp6(3),t.Q6J("data-qa","btn-cancel-import"),t.xp6(1),t.hij(" ",t.lcZ(31,28,"app.cancel")," "),t.xp6(2),t.Q6J("data-qa","btn-finish"),t.xp6(1),t.hij(" ",t.lcZ(34,30,"app.import")," ")}}function lt(o,n){if(1&o&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.message," ")}}function ct(o,n){if(1&o&&(t.ynx(0),t.YNc(1,lt,2,1,"mat-error",23),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.uploadErrors)}}function pt(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",10)(2,"span",11),t._UZ(3,"mat-icon",12),t._uU(4),t.qZA(),t._UZ(5,"mat-icon",13),t.TgZ(6,"span",11),t._UZ(7,"mat-icon",14),t._uU(8),t.qZA()(),t.YNc(9,st,35,32,"ng-container",1),t.YNc(10,ct,2,1,"ng-container",1),t.BQk()),2&o){const e=t.oxw();t.xp6(4),t.hij(" ",e.selectedFile.name," "),t.xp6(4),t.hij(" ",e.selectedForm.name," "),t.xp6(1),t.Q6J("ngIf",0===(null==e.uploadErrors?null:e.uploadErrors.length)),t.xp6(1),t.Q6J("ngIf",e.uploadErrors.length>0)}}const mt=function(o){return{selectedfile:o}};var h=(()=>{return(o=h||(h={})).Published="published",o.Draft="draft",o.Archived="archived",h;var o})();class f extends w.H{sessionService;breakpointService;importService;translateService;notification;pollingService;loader;router;route;confirm;formsService;surveysService;PostStatus=h;selectedFile;selectedForm;forms$;uploadedCSV;hasRequiredTask=!1;requiredFields=new Map;maps_to={};uploadErrors=[];importErrors=!1;fileChanged=!1;surveys;statusOption;selectedStatus;displayedColumns=["survey","csv"];constructor(n,e,i,r,s,l,C,yt,At,Tt,bt,It){super(n,e),this.sessionService=n,this.breakpointService=e,this.importService=i,this.translateService=r,this.notification=s,this.pollingService=l,this.loader=C,this.router=yt,this.route=At,this.confirm=Tt,this.formsService=bt,this.surveysService=It,this.checkDesktop()}ngOnInit(){this.getSurveys()}getSurveys(){this.surveysService.get().subscribe(n=>{this.surveys=(0,k.of)(n.results)})}loadData(){}uploadFile(n){this.fileChanged=!0;const e=new FileReader;e.onload=()=>{this.selectedFile=n.target.files[0],this.checkFormAndFile()},e.readAsDataURL(n.target.files[0])}transformAttributes(n){const e=p().chain(n).filter({type:"title"}).reduce(function(s,l){return s.concat({key:"title",label:l.label,priority:0,required:!0,type:"title"})},[]).value(),i=p().chain(n).filter({type:"description"}).reduce(function(s,l){return s.concat({key:"content",label:l.label,priority:0,required:!0,type:"description"})},[]).value(),r=p().chain(n).filter({type:"point"}).reduce(function(s,l){return s.concat({key:l.key+".lat",label:l.label+" (Latitude)",priority:l.priority,required:l.required},{key:l.key+".lon",label:l.label+" (Longitude)",priority:l.priority,required:l.required})},[]).value();return p().chain(n).reject({type:"point"}).reject({type:"title"}).reject({type:"description"}).push(...e).push(...i).push(...r).sortBy("priority").value()}checkFormAndFile(){this.selectedFile&&this.selectedForm&&(this.fileChanged?(this.loader.show(),this.importService.uploadFile(this.selectedFile,this.selectedForm.id).subscribe({next:n=>{if(this.uploadedCSV=n.result,this.fileChanged=!1,this.uploadedCSV.columns?.every(e=>""===e))return this.notification.showError(this.translateService.instant("notify.data_import.empty_mapping_empty"));this.proceedAttributes(),this.uploadErrors=[]},error:n=>{this.uploadErrors=n.error.errors,this.notification.showError(n),this.loader.hide()}})):this.proceedAttributes())}proceedAttributes(){this.selectedForm.tasks.forEach(n=>{n.fields=this.transformAttributes(n.fields)}),this.hasRequiredTask=this.selectedForm.tasks.some(n=>n.required),this.setRequiredFields(),this.loader.hide()}getFieldKey(n){return"title"===n.type?"title":"description"===n.type?"content":n.key}formChanged(){this.selectedFile&&this.selectedForm&&this.checkFormAndFile()}setRequiredFields(){this.requiredFields.clear(),this.selectedForm.tasks.forEach(n=>{n.fields.forEach(e=>{e.required&&this.requiredFields.set(this.getFieldKey(e),e.label)})})}cancelImport(){this.confirm.open({title:this.translateService.instant("notify.data_import.csv_import_cancel_confirm")}).then(()=>{this.notification.showError(this.translateService.instant("notify.data_import.csv_import_cancel")),this.importService.delete(this.uploadedCSV.id).subscribe(()=>{this.router.navigate(this.isDesktop?["/settings/data-import"]:["/settings"])})})}remapColumns(){let n=(0,_.invert)((0,_.clone)(this.maps_to));n=(0,_.omit)(n,"");const e=(0,_.keys)(n);return this.uploadedCSV.columns.forEach((i,r)=>{n[r]=(0,_.includes)(e,r.toString())?n[r]:null}),n}validateCSV(){if(p().every(this.uploadedCSV.maps_to,p().isEmpty))return this.notification.showError(this.translateService.instant("notify.data_import.no_mappings")),!1;const e=this.checkForDuplicates(),i=e.filter(s=>""===s).length===e.length;if(e.length>0&&!i)return this.notification.showError(this.translateService.instant("notify.data_import.duplicate_fields",{duplicates:e.join(", ")})),!1;if(e.length>0)return this.notification.showError(this.translateService.instant("notify.data_import.empty_mapping_empty")),!1;const r=this.checkRequiredFields(this.maps_to);return!!p().isEmpty(r)||(this.notification.showError(this.translateService.instant("notify.data_import.required_fields",{required:r.join(", ")})),!1)}checkForDuplicates(){const n=p().omitBy(this.maps_to,p().isNil);return p().chain(n).map(e=>this.uploadedCSV.columns[e]).countBy(e=>e).pickBy(e=>e>1).keys().value()}checkRequiredFields(n){console.log(n);const e=[];return this.requiredFields.forEach((i,r)=>{p().isNil(n[r])&&e.push(i)}),e}finish(){this.uploadedCSV.maps_to=this.remapColumns(),this.validateCSV()&&(this.uploadedCSV.fixed={form:this.selectedForm.id},this.selectedStatus&&("mark_as"===this.statusOption?this.uploadedCSV.fixed.status=this.selectedStatus:this.uploadedCSV.maps_to[this.selectedStatus]="status"),this.updateAndImport())}updateAndImport(){this.importService.update(this.uploadedCSV.id,this.uploadedCSV).subscribe(()=>{this.importService.import({id:this.uploadedCSV.id,action:"import"}).subscribe({next:()=>{this.router.navigate(["results"],{relativeTo:this.route,queryParams:{job:this.uploadedCSV.id}})},error:()=>{this.importErrors=!0}})})}static \u0275fac=function(e){return new(e||f)(t.Y36(D.mj),t.Y36(D.r),t.Y36(A.km),t.Y36(u.sK),t.Y36(j.g),t.Y36(T.x),t.Y36(Y.D),t.Y36(m.F0),t.Y36(m.gz),t.Y36(E.h),t.Y36(A.s8),t.Y36(A.w4))};static \u0275cmp=t.Xpm({type:f,selectors:[["app-data-import"]],features:[t.qOj],decls:19,vars:23,consts:[[1,"head"],[4,"ngIf"],[1,"upload-button",3,"data-qa"],["icon","","svgIcon","plus"],["name","file","type","file","accept",".csv",3,"change"],[1,"form-row"],["appearance","outline"],["disableOptionCentering","",3,"data-qa","value","placeholder","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-row","metadata"],[1,"metadata__title"],["svgIcon","document-csv"],["svgIcon","arrow-right",1,"metadata__separator"],["svgIcon","survey"],[3,"data-qa","ngModel","ngModelChange"],[1,"radio-button"],["value","mark_as"],["class","radio-button__content",4,"ngIf"],["value","defined_column"],["class","radio-group",4,"ngIf"],[1,"table-description"],[1,"form-label"],[4,"ngFor","ngForOf"],[1,"form-controls-spacer"],[1,"form-controls-panel","form-controls-panel--sticky"],["fill","outline","color","secondary",3,"data-qa","buttonClick"],[3,"data-qa","buttonClick"],[1,"radio-button__content"],[3,"ngModel","data-qa","ngModelChange"],[1,"radio-group"],["disableOptionCentering","",3,"ngModel","placeholder","ngModelChange"],["mat-table","",3,"dataSource"],["matColumnDef","survey"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","csv"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["disableOptionCentering","",3,"data-qa","ngModel","placeholder","ngModelChange"],["selected","selected","value",""],["mat-header-row",""],["mat-row",""]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.YNc(1,V,3,3,"h1",1),t.TgZ(2,"mzima-client-button",2)(3,"span"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"mat-icon",3),t.TgZ(7,"input",4),t.NdJ("change",function(s){return i.uploadFile(s)}),t.qZA()()(),t.TgZ(8,"div",5)(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"mat-form-field",6)(14,"mat-select",7),t.NdJ("valueChange",function(s){return i.selectedForm=s})("selectionChange",function(){return i.formChanged()}),t.ALo(15,"translate"),t.YNc(16,R,2,2,"mat-option",8),t.ALo(17,"async"),t.qZA()()(),t.YNc(18,pt,11,4,"ng-container",1)),2&e&&(t.xp6(1),t.Q6J("ngIf",i.isDesktop),t.xp6(1),t.Q6J("data-qa","btn-upload"),t.xp6(2),t.hij(" ",t.xi3(5,10,i.selectedFile?"data_import.change_csv_file":"data_import.upload_csv_file",t.VKq(21,mt,i.selectedFile?i.selectedFile.name.slice(0,i.selectedFile.name.length-4):null))," "),t.xp6(6),t.AsE("",t.lcZ(11,13,"data_import.import_to")," ",t.lcZ(12,15,"data_import.which_survey"),"*"),t.xp6(4),t.s9C("placeholder",t.lcZ(15,17,"survey.choose_survey")),t.Q6J("data-qa","select-survey")("value",i.selectedForm),t.xp6(2),t.Q6J("ngForOf",t.lcZ(17,19,i.surveys)),t.xp6(2),t.Q6J("ngIf",i.selectedForm&&i.selectedFile))},dependencies:[d.sg,d.O5,N.xG,g.TO,g.KE,g.bx,g.hX,q.gD,z.ey,F.Hw,y.VQ,y.U0,Z.JJ,Z.On,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,J.r,d.Ov,u.X$],styles:[".head[_ngcontent-%COMP%]{display:flex;margin-bottom:24px;align-items:center;justify-content:space-between}@media only screen and (max-width: 1024px){.head[_ngcontent-%COMP%]{justify-content:flex-end}}.head[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:0}.metadata[_ngcontent-%COMP%]{display:flex;font-size:16px;font-weight:700;line-height:1.5;align-items:center;color:var(--color-black);justify-content:flex-start}@media only screen and (max-width: 1024px){.metadata[_ngcontent-%COMP%]{min-width:200px;display:inline-flex;align-items:stretch;flex-direction:column}}.metadata__title[_ngcontent-%COMP%]{display:flex;overflow:hidden;white-space:nowrap;align-items:center;text-overflow:ellipsis;justify-content:flex-start;max-width:calc(50% - 48px)}@media only screen and (max-width: 1024px){.metadata__title[_ngcontent-%COMP%]{max-width:none}}.metadata__title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:32px;margin-inline-end:4px}.metadata__separator[_ngcontent-%COMP%]{line-height:1;margin:0 32px;font-size:24px}@media only screen and (max-width: 1366px){.metadata__separator[_ngcontent-%COMP%]{margin:0 24px}}@media only screen and (max-width: 1024px){.metadata__separator[_ngcontent-%COMP%]{margin:8px 0;align-self:center;transform:rotate(90deg)}}.metadata[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:1em;height:1em;flex-shrink:0}.metadata[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]  svg{display:block}.form-controls-spacer[_ngcontent-%COMP%]{padding-top:70px}.mat-table[_ngcontent-%COMP%]{margin-bottom:32px}.mat-table[_ngcontent-%COMP%]   .mat-form-field-appearance-outline[_ngcontent-%COMP%]  .mat-form-field-wrapper{padding-top:5px;padding-bottom:5px}.mat-radio-group[_ngcontent-%COMP%]  .mat-radio-label{padding-top:8px;padding-bottom:8px}.radio-button[_ngcontent-%COMP%]{font-size:16px;margin-top:8px;font-weight:500;line-height:1.25}.radio-button__content[_ngcontent-%COMP%]{padding-top:16px;padding-left:44px}@media only screen and (max-width: 1366px){.radio-button__content[_ngcontent-%COMP%]{padding-left:24px}}.radio-button__content[_ngcontent-%COMP%]   .mat-radio-group[_ngcontent-%COMP%]{display:block;padding-top:0;margin-top:-8px}.radio-button__content[_ngcontent-%COMP%]   .radio-button[_ngcontent-%COMP%]:first-child{margin-top:0}.table-description[_ngcontent-%COMP%]{font-size:14px;line-height:1.3;margin-bottom:24px;color:var(--color-neutral-90)}.table-description[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:8px}.table-description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]})}var P=a(4540),U=a(20117),dt=a(61615);const _t=function(o){return{filename:o}},ut=function(o){return["/feed/collection",o]},Q=function(){return["/settings/data-import"]};function gt(o,n){if(1&o&&(t.ynx(0),t._UZ(1,"app-lottie-animation",5),t.TgZ(2,"h1"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",6),t._UZ(6,"p",7),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",8)(9,"mzima-client-button",9),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"mzima-client-button",10),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("path","/assets/lottie/success-animation.json"),t.xp6(2),t.Oqu(t.lcZ(4,7,"data_import.import_complete")),t.xp6(3),t.Q6J("innerHTML",t.xi3(7,9,"data_import.complete_info",t.VKq(16,_t,e.filename)),t.oJD),t.xp6(3),t.Q6J("routerLink",t.VKq(18,ut,e.collectionId)),t.xp6(1),t.hij(" ",t.lcZ(11,12,"data_import.see_imported_posts")," "),t.xp6(2),t.Q6J("routerLink",t.DdM(20,Q)),t.xp6(1),t.hij(" ",t.lcZ(14,14,"data_import.import_another")," ")}}function ht(o,n){1&o&&(t._UZ(0,"app-lottie-animation",5),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("path","/assets/lottie/error-animation.json"),t.xp6(2),t.Oqu(t.lcZ(3,2,"data_import.import_error")))}function ft(o,n){if(1&o&&(t.TgZ(0,"div",2),t.YNc(1,gt,15,21,"ng-container",3),t.YNc(2,ht,4,4,"ng-template",null,4,t.W1O),t.qZA()),2&o){const e=t.MAs(3),i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.importSuccess)("ngIfElse",e)}}function xt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mzima-client-button",13),t.NdJ("buttonClick",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.getPollingInfo())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"data_import.get_polling_info")," "))}function vt(o,n){if(1&o&&(t._UZ(0,"mat-progress-bar",11),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",6)(5,"p"),t._uU(6),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"div",8),t.YNc(9,xt,3,3,"mzima-client-button",12),t.TgZ(10,"mzima-client-button",10),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"pre"),t._uU(14),t.ALo(15,"json"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,6,"data_import.nearly_complete")),t.xp6(4),t.Oqu(t.lcZ(7,8,"data_import.finish_info")),t.xp6(3),t.Q6J("ngIf",e.document.magic),t.xp6(1),t.Q6J("routerLink",t.DdM(14,Q)),t.xp6(1),t.hij(" ",t.lcZ(12,10,"data_import.import_another")," "),t.xp6(3),t.Oqu(t.lcZ(15,12,e.pollingInfo))}}let b=class I{pollingService;router;route;importFinished=!1;importSuccess=!1;filename;collectionId;importJobs;pollingInfo;document=document;constructor(n,e,i){this.pollingService=n,this.router=e,this.route=i}ngOnInit(){const n=this.route.snapshot.queryParamMap.get("job")?.split(",");n?(this.pollingService.getImportJobsById(n),this.pollingImportFinished()):(this.pollingService.getImportJobs(),this.pollingImportFinished())}pollingImportFinished(){this.pollingService.importFinished$.pipe((0,U.t)(this)).subscribe(n=>{this.importFinished=!0,this.importSuccess="SUCCESS"===n.status,this.collectionId=n.collection_id,this.filename=n.filename})}getPollingInfo(){this.pollingInfo=this.pollingService.getCurrentPool()}static \u0275fac=function(e){return new(e||I)(t.Y36(T.x),t.Y36(m.F0),t.Y36(m.gz))};static \u0275cmp=t.Xpm({type:I,selectors:[["app-import-results"]],decls:3,vars:2,consts:[["class","completed",4,"ngIf","ngIfElse"],["notFinished",""],[1,"completed"],[4,"ngIf","ngIfElse"],["importFailed",""],[1,"visual",3,"path"],[1,"description"],[3,"innerHTML"],[1,"form-controls-panel"],["fill","outline","color","secondary",3,"routerLink"],[3,"routerLink"],["mode","indeterminate",1,"progress"],["fill","outline","color","secondary",3,"buttonClick",4,"ngIf"],["fill","outline","color","secondary",3,"buttonClick"]],template:function(e,i){if(1&e&&(t.YNc(0,ft,4,2,"div",0),t.YNc(1,vt,16,15,"ng-template",null,1,t.W1O)),2&e){const r=t.MAs(2);t.Q6J("ngIf",i.importFinished)("ngIfElse",r)}},dependencies:[d.O5,m.rH,M.pW,dt.c,J.r,d.Ts,u.X$],styles:["h1[_ngcontent-%COMP%]{margin-bottom:16px}.progress[_ngcontent-%COMP%]{top:0;left:0;right:0;position:absolute}.form-controls-panel[_ngcontent-%COMP%]{margin-top:16px}.description[_ngcontent-%COMP%]{font-size:16px;line-height:1.5}.completed[_ngcontent-%COMP%]{text-align:center}.completed[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:24px}.completed[_ngcontent-%COMP%]   .form-controls-panel[_ngcontent-%COMP%]{margin-top:40px}.visual[_ngcontent-%COMP%]{display:block;margin-bottom:16px}"]})};b=(0,P.gn)([(0,U.c)(),(0,P.w6)("design:paramtypes",[T.x,m.F0,m.gz])],b);const Ct=[{path:"",component:f},{path:"results",component:b,data:{breadcrumb:"Results"}}];class x{static \u0275fac=function(e){return new(e||x)};static \u0275mod=t.oAB({type:x});static \u0275inj=t.cJS({imports:[m.Bz.forChild(Ct),m.Bz]})}var Zt=a(17733);class v{static \u0275fac=function(e){return new(e||v)};static \u0275mod=t.oAB({type:v});static \u0275inj=t.cJS({imports:[d.ez,x,M.Cv,u.aw,L.ot,S.Z6,q.LD,F.Ps,y.Fk,Z.u5,c.p0,S.zZ,Zt.e]})}}}]);
//# sourceMappingURL=158.489a0d114cdfe54c.js.map