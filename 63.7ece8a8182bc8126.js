"use strict";(self.webpackChunkweb_mzima_client=self.webpackChunkweb_mzima_client||[]).push([[63],{23063:(P,v,o)=>{o.r(v),o.d(v,{UserSettingsModule:()=>d});var p=o(52954),r=o(93557),k=o(95432),x=o(37661),Z=o(33695),y=o(81547),C=o(89857),c=o(40930),A=o(4540),T=o(33646),u=o(59132),f=o(49119),S=o(20117),t=o(39609),m=o(952),U=o(53625),I=o(93149);function b(n,e){1&n&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"settings.settings_list.user_settings")))}function L(n,e){1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"settings.user_settings.valid_user")," "))}function q(n,e){1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"settings.user_settings.hdx_maintainer_id_min_length")," "))}function O(n,e){if(1&n&&(t.TgZ(0,"mat-error"),t.YNc(1,L,3,3,"div",1),t.YNc(2,q,3,3,"div",1),t.qZA()),2&n){const i=t.oxw();let s,a;t.xp6(1),t.Q6J("ngIf",null==(s=i.form.get("hdx_maintainer_id"))?null:s.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==(a=i.form.get("hdx_maintainer_id"))?null:a.hasError("minlength"))}}function J(n,e){1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"settings.user_settings.valid_key")," "))}function N(n,e){1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"settings.user_settings.api_key_min_length")," "))}function z(n,e){if(1&n&&(t.TgZ(0,"mat-error"),t.YNc(1,J,3,3,"div",1),t.YNc(2,N,3,3,"div",1),t.qZA()),2&n){const i=t.oxw();let s,a;t.xp6(1),t.Q6J("ngIf",null==(s=i.form.get("hdx_api_key"))?null:s.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==(a=i.form.get("hdx_api_key"))?null:a.hasError("minlength"))}}function Y(n,e){1&n&&t._UZ(0,"div",16)}function w(n,e){1&n&&(t.TgZ(0,"mzima-client-button",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.Q6J("data-qa","btn-cancel"),t.xp6(1),t.hij(" ",t.lcZ(2,2,"app.cancel")," "))}let h=class _{formBuilder;usersService;breakpointService;notificationService;router;userId;isDesktop$;form;submitted=!1;constructor(e,i,s,a,l){this.formBuilder=e,this.usersService=i,this.breakpointService=s,this.notificationService=a,this.router=l,this.isDesktop$=this.breakpointService.isDesktop$.pipe((0,S.t)(this)),this.userId=localStorage.getItem(`${f.X2.o.LOCAL_STORAGE_PREFIX}userId`),this.form=this.formBuilder.group({hdx_maintainer_id:["",[r.kI.required,r.kI.minLength(3)]],maintainer_id:[""],hdx_api_key:["",[r.kI.required,r.kI.minLength(3)]],api_id:[""]})}ngOnInit(){this.getSettingsHDX()}getSettingsHDX(){this.usersService.getUserSettings(this.userId).subscribe({next:e=>{e.results?.forEach(i=>{this.updateSettings(i)})}})}updateSettings(e){"hdx_api_key"===e.config_key&&(e.config_value="*** *** *** *** *** *** *** "+e.config_value.slice(e.config_value.length-4),this.form.patchValue({hdx_api_key:e.config_value,api_id:e.id})),"hdx_maintainer_id"===e.config_key&&this.form.patchValue({hdx_maintainer_id:e.config_value,maintainer_id:e.id})}saveInformation(){this.submitted=!0;const e={user_id:this.userId},i=[];i.push(this.saveMaintainer(e)),this.form.controls.hdx_api_key.value.includes("*")||i.push(this.saveHdxApi(e)),(0,T.D)(i).subscribe({next:()=>{this.submitted=!1,this.getSettingsHDX(),this.showNotification("success")},error:s=>{console.log(s),this.submitted=!1,this.showNotification("error")}})}saveMaintainer(e){const i={...e,id:this.form.controls.maintainer_id.value||null,config_key:"hdx_maintainer_id",config_value:this.form.controls.hdx_maintainer_id.value};return this.form.controls.maintainer_id.value?this.usersService.updateUserSettings(this.userId,i,this.form.controls.maintainer_id.value):this.usersService.postUserSettings(this.userId,i)}saveHdxApi(e){const i={...e,id:this.form.controls.api_id.value||null,config_key:"hdx_api_key",config_value:this.form.controls.hdx_api_key.value};return this.form.controls.api_id.value?this.usersService.updateUserSettings(this.userId,i,this.form.controls.api_id.value):this.usersService.postUserSettings(this.userId,i)}showNotification(e){"success"===e?this.displaySnackBar({icon:{color:"success",name:"thumb-up"},title:"settings.user_settings.api_key_saved",buttons:[{color:"primary",text:"notify.export.confirmation"}]}):this.notificationService.showError("Failed to export")}displaySnackBar(e){this.notificationService.showSnackbar(e,{duration:0,wide:!0})}static \u0275fac=function(i){return new(i||_)(t.Y36(r.qu),t.Y36(f.fz),t.Y36(u.r),t.Y36(u.gq),t.Y36(c.F0))};static \u0275cmp=t.Xpm({type:_,selectors:[["app-user-settings"]],decls:52,vars:49,consts:[[1,"form-head-panel"],[4,"ngIf"],[1,"logo-wrapper"],["src","assets/images/logo-hdx.png",3,"alt"],[1,"information"],["href","https://data.humdata.org/faq","target","_blank",1,"guide-link"],["svgIcon","external-link",1,"link-blue-icon"],["novalidate","",3,"formGroup"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","hdx_maintainer_id","required","",3,"placeholder"],["matInput","","formControlName","hdx_api_key","required","",3,"placeholder"],["class","form-controls-spacer",4,"ngIf"],[1,"form-controls-panel","form-controls-panel--sticky"],["type","button","fill","outline","color","secondary","routerLink","/settings",3,"data-qa",4,"ngIf"],["type","submit",3,"disabled","buttonClick"],[1,"form-controls-spacer"],["type","button","fill","outline","color","secondary","routerLink","/settings",3,"data-qa"]],template:function(i,s){if(1&i&&(t.TgZ(0,"div",0),t.YNc(1,b,3,3,"h1",1),t.ALo(2,"async"),t.TgZ(3,"div",2),t._UZ(4,"img",3),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"div",4)(7,"p"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"p"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"a",5),t._UZ(17,"mat-icon",6),t.TgZ(18,"strong"),t._uU(19),t.ALo(20,"translate"),t.qZA()()(),t.TgZ(21,"form",7)(22,"div",8)(23,"mat-label"),t._uU(24),t.ALo(25,"translate"),t.qZA(),t.TgZ(26,"mat-form-field",9),t._UZ(27,"input",10),t.ALo(28,"translate"),t.TgZ(29,"mat-hint"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.YNc(32,O,3,2,"mat-error",1),t.qZA()(),t.TgZ(33,"div",8)(34,"mat-label"),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"mat-form-field",9),t._UZ(38,"input",11),t.ALo(39,"translate"),t.TgZ(40,"mat-hint"),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.YNc(43,z,3,2,"mat-error",1),t.qZA()(),t.YNc(44,Y,1,0,"div",12),t.ALo(45,"async"),t.TgZ(46,"div",13),t.YNc(47,w,3,4,"mzima-client-button",14),t.ALo(48,"async"),t.TgZ(49,"mzima-client-button",15),t.NdJ("buttonClick",function(){return s.saveInformation()}),t._uU(50),t.ALo(51,"translate"),t.qZA()()()),2&i){let a,l;t.xp6(1),t.Q6J("ngIf",t.lcZ(2,19,s.isDesktop$)),t.xp6(3),t.s9C("alt",t.lcZ(5,21,"settings.user_settings.HDX")),t.xp6(4),t.Oqu(t.lcZ(9,23,"settings.user_settings.user_settings_desc_1")),t.xp6(3),t.Oqu(t.lcZ(12,25,"settings.user_settings.user_settings_desc_2")),t.xp6(3),t.Oqu(t.lcZ(15,27,"settings.user_settings.user_settings_desc_3")),t.xp6(5),t.Oqu(t.lcZ(20,29,"settings.user_settings.view_guide")),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(3),t.Oqu(t.lcZ(25,31,"settings.user_settings.hdx_maintainer_id")),t.xp6(3),t.s9C("placeholder",t.lcZ(28,33,"settings.user_settings.please_enter_maintainer_id")),t.xp6(3),t.Oqu(t.lcZ(31,35,"settings.user_settings.profile_page")),t.xp6(2),t.Q6J("ngIf",(null==(a=s.form.get("hdx_maintainer_id"))?null:a.touched)&&(null==(a=s.form.get("hdx_maintainer_id"))?null:a.invalid)),t.xp6(3),t.Oqu(t.lcZ(36,37,"settings.user_settings.api_key")),t.xp6(3),t.s9C("placeholder",t.lcZ(39,39,"settings.user_settings.please_enter_api_key")),t.xp6(3),t.Oqu(t.lcZ(42,41,"settings.user_settings.profile_page")),t.xp6(2),t.Q6J("ngIf",(null==(l=s.form.get("hdx_api_key"))?null:l.touched)&&(null==(l=s.form.get("hdx_api_key"))?null:l.invalid)),t.xp6(1),t.Q6J("ngIf",!t.lcZ(45,43,s.isDesktop$)),t.xp6(3),t.Q6J("ngIf",!t.lcZ(48,45,s.isDesktop$)),t.xp6(2),t.Q6J("disabled",s.form.invalid||s.submitted),t.xp6(1),t.hij(" ",t.lcZ(51,47,"app.save")," ")}},dependencies:[p.O5,c.rH,r._Y,r.Fj,r.JJ,r.JL,r.Q7,r.sg,r.u,m.TO,m.KE,m.bx,m.hX,Z.Nt,U.zL,U.xG,x.Hw,I.r,p.Ov,y.X$],styles:[".information[_ngcontent-%COMP%]{margin-bottom:32px}.information[_ngcontent-%COMP%]   .guide-link[_ngcontent-%COMP%]{display:flex;align-items:center}.information[_ngcontent-%COMP%]   .link-blue-icon[_ngcontent-%COMP%]{width:1em;height:1em;display:flex;flex-shrink:0;line-height:1;font-size:20px;margin-right:4px;align-items:center}.logo-wrapper[_ngcontent-%COMP%]{max-width:220px;margin-inline-start:16px}@media only screen and (max-width: 1366px){.logo-wrapper[_ngcontent-%COMP%]{max-width:164px}}@media only screen and (max-width: 1024px){.logo-wrapper[_ngcontent-%COMP%]{margin-inline-start:0}}.logo-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;max-width:100%;max-height:48px;object-fit:contain;object-position:100% 50%}"]})};h=(0,A.gn)([(0,S.c)(),(0,A.w6)("design:paramtypes",[r.qu,f.fz,u.r,u.gq,c.F0])],h);const M=[{path:"",component:h}];class g{static \u0275fac=function(i){return new(i||g)};static \u0275mod=t.oAB({type:g});static \u0275inj=t.cJS({imports:[c.Bz.forChild(M),c.Bz]})}var Q=o(17733);class d{static \u0275fac=function(i){return new(i||d)};static \u0275mod=t.oAB({type:d});static \u0275inj=t.cJS({imports:[p.ez,g,y.aw,r.UX,Z.c,k.ot,C.Z6,x.Ps,Q.e]})}}}]);
//# sourceMappingURL=63.7ece8a8182bc8126.js.map